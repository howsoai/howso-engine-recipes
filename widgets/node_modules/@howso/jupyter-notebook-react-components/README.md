# jupyter-notebook-react-components

Provides ESM and CSS packages of Howso UI components to integrate two way data binding with notebooks.

The two way data binding is controlled by [ipyreact](https://ipyreact.readthedocs.io/en/latest/user-guide.html).
It provides a limited surface area for control widgets. A simple `value` and `setValue` pair similar to `useState`.
UI components in this library are built on strict JSON implementations using `ipyreact`s API, translated
into our standard UI elements after.

## Usage

To use this package in your application install it via npm.

### Prerequisites

Your home directory must contain a `.npmrc` file pointing to the Azure DevOps artifact feed:

```text
@howso:registry = https://dpbuild.jfrog.io/artifactory/api/npm/npm-virtual/
//dpbuild.jfrog.io/artifactory/api/npm/npm-virtual/:_auth=...
```

### Installation

Ensure your `requirements` file includes `ipyreact`.

Create a `./widgets/package.json` directory in your application with these contents:

```json
{
  "name": "@howso/widgets",
  "description": "A local package to help manage updates of the @howso/jupyter-notebook-react-components package",
  "main": "index.js",
  "license": "ISC",
  "dependencies": {
    "@howso/jupyter-notebook-react-components": "jupyter-notebook-react-components@^1.0.1"
  }
}
```

Include this `./widgets/.gitignore` section as well to ensure the built files are committed to the repository.

```gitignore
# NPM
node_modules/*

# Howso compiled widget code
!node_modules/@howso
node_modules/@howso/*
!node_modules/@howso/jupyter-notebook-react-components
node_modules/@howso/jupyter-notebook-react-components/node_modules
!node_modules/@howso/jupyter-notebook-react-components/lib
```

You can then install the required dependencies using:

```bash
npm i
```

### Adding widgets in cells

You are advised to create constants for reuse in your notebooks:

```py
import pathlib
from IPython.display import HTML

# Setup notebook widget path
widget_path = pathlib.Path("../widgets/node_modules/@howso/jupyter-notebook-react-components/lib")
# Define your theme preference
widgets_theme_mode = "light" # "auto" (OS or browser preference), "dark" or "light"
```

Each widget produced by this package can be consumed directly from the package exports as ESM code
that plugs directly into `ipyreact`'s controllers as you need them.

These example blocks will provide the Feature Attributes interface:

Embed the UI for interaction, providing an initial `value` as feature attributes serialized to JSON:

Your notebook provider may require one of two different setups. If they provide the results
of each cell in an `iframe`, the following code will be all you need:

#### Bundled providers

Known providers:

- Databricks

```py
import ipyreact
import traitlets

class FeatureAttributesWidget(ipyreact.ValueWidget):
    _esm = widget_path / "index.bundle.esm.js" # Not the '.bundle' file in use
    name = traitlets.Unicode().tag(sync=True)

feature_attributes_widget = FeatureAttributesWidget(
    props={
        "control": "FeaturesAttributesControl", # Which Control you want
        "themeMode": widgets_theme_mode,
    },
    # The two data data binding value as JSON
    value=feature_attributes.to_json(),
)
feature_attributes_widget
```

#### Unbundled providers

- VSCode
- `jupyter notebook` CLI

Unbundled providers are encouraged to load the styles only once, globally.

Your notebook needs to include the CSS and Font files through direct HTML addition once per recipe.
This additional will affect styles in your application, globally. Our package is built on
[tailwind](https://tailwindcss.com/), which focuses on utility classes over generic css,
but it is possible your notebook's styles may be affected.

```py
# Output the required css
css_rules = pathlib.Path(widget_path / "index.esm.css").read_text()
HTML("<style>" + css_rules + "</style>")
```

```py
import ipyreact
import traitlets

class FeatureAttributesWidget(ipyreact.ValueWidget):
    _esm = widget_path / "index.esm.js" # Note the non-bundled file in use
    name = traitlets.Unicode().tag(sync=True)

feature_attributes_widget = FeatureAttributesWidget(
    props={
        "control": "FeaturesAttributesControl", # Which Control you want
        "themeMode": widgets_theme_mode,
    },
    # The two data data binding value as JSON
    value=feature_attributes.to_json(),
)
feature_attributes_widget
```

### Using the widget value

Access the JSON stringified `value` of the `FeatureAttributesWidget` in future blocks as needed:

```py
feature_attributes_widget.value
```

It is possible alter the values through assignment if required, but controlling the features in two
methods is likely to cause user confusion. Use caution, but you may:

```py
feature_attributes_widget.value = '{"x": { "type": "continuous", "data_type": "number", "bounds": { "min": 0 } } }'
```

## Warnings

### JSON as value complexities

```py
# ❌ Invalid - Will yield "invalid control character" when rendering. Note the '}}' right next to each other.
value='{ "foo": { "bar": 2 }}'
# ✅ Valid - Note the space between '{' and '}' characters.
value='{ "foo": { "bar": 2 } }'
```

It's far easier and safer to use a `feature_attributes` variable and call the `to_json()` method.

### VS Code

- VS Code's integration has issues at times with running the widget code block multiple times.
- VS Code also treats the entire notebook as the `body` element which causes modal interfaces to be unusable.

These do not happen on notebooks run through the `jupyter notebook` command or hosted.
We recommend using the hosted notebook to interact with our software.

## Contributing

Development is done through [Storybook](https://storybook.js.org/).
You may start the UI for inspection with hot reloading using:

```bash
npm run storybook
```

## Publishing

This package is published into a private npm registry.

Documentation changes do not require a version publishing.
For functional changes, follow [SemVer](https://semver.org/)
standards updating the `package.json` and `package-lock.json`
files in your pull request.

When you are ready to publish a new version, use the Github Release action.
